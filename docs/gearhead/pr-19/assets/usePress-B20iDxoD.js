import{A as $e,e as M,E as Pe,F as ye,a as E,m as P,q as d,G as be,H as Te,I as Ee,J as j,B as he,K as me,w as ke,v as Q}from"./useFocusRing-ubySK4Mk.js";import{$ as Z,a as xe}from"./textSelection-BF8X-_NC.js";import{R as Se,r as p}from"./index-Dq4ZvVuH.js";import{f as ee,o as Ce,$ as ie}from"./utils-LaqegW2K.js";import"./index-BodQkoVg.js";function Ke(r,a){if(a.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function we(r,a,o){Ke(r,a),a.set(r,o)}const oe=Se.createContext({register:()=>{}});oe.displayName="PressResponderContext";function Ie(r,a){return a.get?a.get.call(r):a.value}function le(r,a,o){if(!a.has(r))throw new TypeError("attempted to "+o+" private field on non-instance");return a.get(r)}function _e(r,a){var o=le(r,a,"get");return Ie(r,o)}function Le(r,a,o){if(a.set)a.set.call(r,o);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=o}}function te(r,a,o){var f=le(r,a,"set");return Le(r,f,o),o}function Me(r){let a=p.useContext(oe);if(a){let{register:o,ref:f,...c}=a;r=ie(c,r),o()}return Ee(a,r.ref),r}var O=new WeakMap;class D{continuePropagation(){te(this,O,!1)}get shouldStopPropagation(){return _e(this,O)}constructor(a,o,f,c){we(this,O,{writable:!0,value:void 0}),te(this,O,!0);var v;let g=(v=c==null?void 0:c.target)!==null&&v!==void 0?v:f.currentTarget;const u=g==null?void 0:g.getBoundingClientRect();let C,m=0,k,$=null;f.clientX!=null&&f.clientY!=null&&(k=f.clientX,$=f.clientY),u&&(k!=null&&$!=null?(C=k-u.left,m=$-u.top):(C=u.width/2,m=u.height/2)),this.type=a,this.pointerType=o,this.target=f.currentTarget,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.x=C,this.y=m,this.key=f.key}}const re=Symbol("linkClicked"),ae="react-aria-pressable-style",se="data-react-aria-pressable";function Be(r){let{onPress:a,onPressChange:o,onPressStart:f,onPressEnd:c,onPressUp:v,onClick:g,isDisabled:u,isPressed:C,preventFocusOnPress:m,shouldCancelOnPointerExit:k,allowTextSelectionOnPress:$,ref:U,...ce}=Me(r),[ue,G]=p.useState(!1),y=p.useRef({isPressed:!1,ignoreEmulatedMouseEvents:!1,didFirePressStart:!1,isTriggeringEvent:!1,activePointerId:null,target:null,isOverTarget:!1,pointerType:null,disposables:[]}),{addGlobalListener:x,removeAllGlobalListeners:K,removeGlobalListener:w}=$e(),I=p.useCallback((e,s)=>{let t=y.current;if(u||t.didFirePressStart)return!1;let n=!0;if(t.isTriggeringEvent=!0,f){let l=new D("pressstart",s,e);f(l),n=l.shouldStopPropagation}return o&&o(!0),t.isTriggeringEvent=!1,t.didFirePressStart=!0,G(!0),n},[u,f,o]),b=p.useCallback((e,s,t=!0)=>{let n=y.current;if(!n.didFirePressStart)return!1;n.didFirePressStart=!1,n.isTriggeringEvent=!0;let l=!0;if(c){let i=new D("pressend",s,e);c(i),l=i.shouldStopPropagation}if(o&&o(!1),G(!1),a&&t&&!u){let i=new D("press",s,e);a(i),l&&(l=i.shouldStopPropagation)}return n.isTriggeringEvent=!1,l},[u,c,o,a]),pe=M(b),_=p.useCallback((e,s)=>{let t=y.current;if(u)return!1;if(v){t.isTriggeringEvent=!0;let n=new D("pressup",s,e);return v(n),t.isTriggeringEvent=!1,n.shouldStopPropagation}return!0},[u,v]),de=M(_),S=p.useCallback(e=>{let s=y.current;if(s.isPressed&&s.target){s.didFirePressStart&&s.pointerType!=null&&b(h(s.target,e),s.pointerType,!1),s.isPressed=!1,W(null),s.isOverTarget=!1,s.activePointerId=null,s.pointerType=null,K(),$||Z(s.target);for(let t of s.disposables)t();s.disposables=[]}},[$,K,b]),A=M(S),z=p.useCallback(e=>{k&&S(e)},[k,S]),R=p.useCallback(e=>{u||g==null||g(e)},[u,g]),N=p.useCallback((e,s)=>{if(!u&&g){let t=new MouseEvent("click",e);Pe(t,s),g(ye(t))}},[u,g]),ge=M(N),[V,q]=p.useState(!1);ee(()=>{let e=y.current;if(V){let s=i=>{var T;if(e.isPressed&&e.target&&Y(i,e.target)){var F;ne(d(i),i.key)&&i.preventDefault();let B=d(i),L=P(e.target,d(i));pe(h(e.target,i),"keyboard",L),L&&ge(i,e.target),K(),i.key!=="Enter"&&X(e.target)&&P(e.target,B)&&!i[re]&&(i[re]=!0,j(e.target,i,!1)),e.isPressed=!1,q(!1),(F=e.metaKeyEvents)===null||F===void 0||F.delete(i.key)}else if(i.key==="Meta"&&(!((T=e.metaKeyEvents)===null||T===void 0)&&T.size)){var H;let B=e.metaKeyEvents;e.metaKeyEvents=void 0;for(let L of B.values())(H=e.target)===null||H===void 0||H.dispatchEvent(new KeyboardEvent("keyup",L))}},t=e.target,l=Ce(i=>{t&&Y(i,t)&&!i.repeat&&P(t,d(i))&&e.target&&de(h(e.target,i),"keyboard")},s);return x(E(e.target),"keyup",l,!0),()=>{w(E(e.target),"keyup",l,!0)}}},[V,x,K,w]);let[J,W]=p.useState(null);ee(()=>{let e=y.current;if(J==="pointer"){let s=n=>{if(n.pointerId===e.activePointerId&&e.isPressed&&n.button===0&&e.target){if(P(e.target,d(n))&&e.pointerType!=null){let l=!1,i=setTimeout(()=>{e.isPressed&&e.target instanceof HTMLElement&&(l?A(n):(he(e.target),e.target.click()))},80);x(n.currentTarget,"click",()=>l=!0,!0),e.disposables.push(()=>clearTimeout(i))}else A(n);e.isOverTarget=!1}},t=n=>{A(n)};return x(E(e.target),"pointerup",s,!1),x(E(e.target),"pointercancel",t,!1),()=>{w(E(e.target),"pointerup",s,!1),w(E(e.target),"pointercancel",t,!1)}}},[J,x,w]);let ve=p.useMemo(()=>{let e=y.current,s={onKeyDown(t){if(Y(t.nativeEvent,t.currentTarget)&&P(t.currentTarget,d(t.nativeEvent))){var n;ne(d(t.nativeEvent),t.key)&&t.preventDefault();let l=!0;!e.isPressed&&!t.repeat&&(e.target=t.currentTarget,e.isPressed=!0,q(!0),e.pointerType="keyboard",l=I(t,"keyboard")),l&&t.stopPropagation(),t.metaKey&&ke()&&((n=e.metaKeyEvents)===null||n===void 0||n.set(t.key,t.nativeEvent))}else t.key==="Meta"&&(e.metaKeyEvents=new Map)},onClick(t){if(!(t&&!P(t.currentTarget,d(t.nativeEvent)))&&t&&t.button===0&&!e.isTriggeringEvent&&!j.isOpening){let n=!0;if(u&&t.preventDefault(),!e.ignoreEmulatedMouseEvents&&!e.isPressed&&(e.pointerType==="virtual"||me(t.nativeEvent))){let l=I(t,"virtual"),i=_(t,"virtual"),T=b(t,"virtual");R(t),n=l&&i&&T}else if(e.isPressed&&e.pointerType!=="keyboard"){let l=e.pointerType||t.nativeEvent.pointerType||"virtual",i=_(h(t.currentTarget,t),l),T=b(h(t.currentTarget,t),l,!0);n=i&&T,e.isOverTarget=!1,R(t),S(t)}e.ignoreEmulatedMouseEvents=!1,n&&t.stopPropagation()}}};return typeof PointerEvent<"u"&&(s.onPointerDown=t=>{if(t.button!==0||!P(t.currentTarget,d(t.nativeEvent)))return;if(be(t.nativeEvent)){e.pointerType="virtual";return}e.pointerType=t.pointerType;let n=!0;if(!e.isPressed){e.isPressed=!0,W("pointer"),e.isOverTarget=!0,e.activePointerId=t.pointerId,e.target=t.currentTarget,$||xe(e.target),n=I(t,e.pointerType);let l=d(t.nativeEvent);"releasePointerCapture"in l&&("hasPointerCapture"in l?l.hasPointerCapture(t.pointerId)&&l.releasePointerCapture(t.pointerId):l.releasePointerCapture(t.pointerId))}n&&t.stopPropagation()},s.onMouseDown=t=>{if(P(t.currentTarget,d(t.nativeEvent))&&t.button===0){if(m){let n=Te(t.target);n&&e.disposables.push(n)}t.stopPropagation()}},s.onPointerUp=t=>{!P(t.currentTarget,d(t.nativeEvent))||e.pointerType==="virtual"||t.button===0&&!e.isPressed&&_(t,e.pointerType||t.pointerType)},s.onPointerEnter=t=>{t.pointerId===e.activePointerId&&e.target&&!e.isOverTarget&&e.pointerType!=null&&(e.isOverTarget=!0,I(h(e.target,t),e.pointerType))},s.onPointerLeave=t=>{t.pointerId===e.activePointerId&&e.target&&e.isOverTarget&&e.pointerType!=null&&(e.isOverTarget=!1,b(h(e.target,t),e.pointerType,!1),z(t))},s.onDragStart=t=>{P(t.currentTarget,d(t.nativeEvent))&&S(t)}),s},[u,m,K,$,S,z,b,I,_,R,N]);return p.useEffect(()=>{if(!U)return;const e=E(U.current);if(!e||!e.head||e.getElementById(ae))return;const s=e.createElement("style");s.id=ae,s.textContent=`
@layer {
  [${se}] {
    touch-action: pan-x pan-y pinch-zoom;
  }
}
    `.trim(),e.head.prepend(s)},[U]),p.useEffect(()=>{let e=y.current;return()=>{var s;$||Z((s=e.target)!==null&&s!==void 0?s:void 0);for(let t of e.disposables)t();e.disposables=[]}},[$]),{isPressed:C||ue,pressProps:ie(ce,ve,{[se]:!0})}}function X(r){return r.tagName==="A"&&r.hasAttribute("href")}function Y(r,a){const{key:o,code:f}=r,c=a,v=c.getAttribute("role");return(o==="Enter"||o===" "||o==="Spacebar"||f==="Space")&&!(c instanceof Q(c).HTMLInputElement&&!fe(c,o)||c instanceof Q(c).HTMLTextAreaElement||c.isContentEditable)&&!((v==="link"||!v&&X(c))&&o!=="Enter")}function h(r,a){let o=a.clientX,f=a.clientY;return{currentTarget:r,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey,altKey:a.altKey,clientX:o,clientY:f,key:a.key}}function Oe(r){return r instanceof HTMLInputElement?!1:r instanceof HTMLButtonElement?r.type!=="submit"&&r.type!=="reset":!X(r)}function ne(r,a){return r instanceof HTMLInputElement?!fe(r,a):Oe(r)}const De=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function fe(r,a){return r.type==="checkbox"||r.type==="radio"?a===" ":De.has(r.type)}export{Be as $,oe as a};
