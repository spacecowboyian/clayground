import{r as n}from"./index-Dq4ZvVuH.js";import{e as h,k as B}from"./useFocusRing-ubySK4Mk.js";import{f as T}from"./utils-LaqegW2K.js";const C={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},D={...C,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:C,validationErrors:[]},U=n.createContext({}),w="__formValidationState"+Date.now();function G(t){if(t[w]){let{realtimeValidation:e,displayValidation:a,updateValidation:o,resetValidation:u,commitValidation:d}=t[w];return{realtimeValidation:e,displayValidation:a,updateValidation:o,resetValidation:u,commitValidation:d}}return j(t)}function j(t){let{isInvalid:e,validationState:a,name:o,value:u,builtinValidation:d,validate:c,validationBehavior:v="aria"}=t;a&&(e||(e=a==="invalid"));let f=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:D}:null,r=n.useMemo(()=>{if(!c||u==null)return null;let l=k(c,u);return L(l)},[c,u]);d!=null&&d.validationDetails.valid&&(d=void 0);let i=n.useContext(U),s=n.useMemo(()=>o?Array.isArray(o)?o.flatMap(l=>M(i[l])):M(i[o]):[],[i,o]),[m,A]=n.useState(i),[S,b]=n.useState(!1);i!==m&&(A(i),b(!1));let p=n.useMemo(()=>L(S?[]:s),[S,s]),x=n.useRef($),[E,g]=n.useState($),V=n.useRef($),R=()=>{if(!O)return;y(!1);let l=r||d||x.current;I(l,V.current)||(V.current=l,g(l))},[O,y]=n.useState(!1);return n.useEffect(R),{realtimeValidation:f||p||r||d||$,displayValidation:v==="native"?f||p||E:f||p||r||d||E,updateValidation(l){v==="aria"&&!I(E,l)?g(l):x.current=l},resetValidation(){let l=$;I(l,V.current)||(V.current=l,g(l)),v==="native"&&y(!1),b(!0)},commitValidation(){v==="native"&&y(!0),b(!0)}}}function M(t){return t?Array.isArray(t)?t:[t]:[]}function k(t,e){if(typeof t=="function"){let a=t(e);if(a&&typeof a!="boolean")return M(a)}return[]}function L(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:D}:null}function I(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((a,o)=>a===e.validationErrors[o])&&Object.entries(t.validationDetails).every(([a,o])=>e.validationDetails[a]===o)}function H(t,e,a){let{validationBehavior:o,focus:u}=t;T(()=>{if(o==="native"&&(a!=null&&a.current)&&!a.current.disabled){let r=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(r),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(P(a.current))}});let d=n.useRef(!1),c=h(()=>{d.current||e.resetValidation()}),v=h(r=>{var i;e.displayValidation.isInvalid||e.commitValidation();let s=a==null||(i=a.current)===null||i===void 0?void 0:i.form;if(!r.defaultPrevented&&a&&s&&Q(s)===a.current){var m;u?u():(m=a.current)===null||m===void 0||m.focus(),B("keyboard")}r.preventDefault()}),f=h(()=>{e.commitValidation()});n.useEffect(()=>{let r=a==null?void 0:a.current;if(!r)return;let i=r.form,s=i==null?void 0:i.reset;return i&&(i.reset=()=>{d.current=!window.event||window.event.type==="message"&&window.event.target instanceof MessagePort,s==null||s.call(i),d.current=!1}),r.addEventListener("invalid",v),r.addEventListener("change",f),i==null||i.addEventListener("reset",c),()=>{r.removeEventListener("invalid",v),r.removeEventListener("change",f),i==null||i.removeEventListener("reset",c),i&&(i.reset=s)}},[a,o])}function F(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function P(t){return{isInvalid:!t.validity.valid,validationDetails:F(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function Q(t){for(let e=0;e<t.elements.length;e++){let a=t.elements[e];if(!a.validity.valid)return a}return null}const J=n.createContext(null);export{J as $,G as a,H as b,w as c,$ as d};
